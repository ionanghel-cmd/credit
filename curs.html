<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Curs Valutar ProCredit Bank & BNM</title>
  <link rel="stylesheet" href="style.css"/>
  <link rel="icon" href="data:,"/>
</head>
<body>
  <div class="container">
    <h1>Rate de Schimb Valutar</h1>
    <p class="subtitle">ProCredit Bank Moldova â€¢ Persoane fizice prin virament</p>
    
    <div class="update">Se Ã®ncarcÄƒ cursul... <span id="status">ðŸ”„</span></div>

    <table id="rates-table">
      <thead>
        <tr>
          <th>Valuta</th>
          <th>ProCredit CumpÄƒrare</th>
          <th>ProCredit VÃ¢nzare</th>
          <th>BNM (referinÈ›Äƒ)</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="4" style="text-align:center; padding:20px;">Se Ã®ncarcÄƒ...</td></tr>
      </tbody>
    </table>

    <div class="footer">
      Actualizat automat â€¢ 
      <span id="last-update">â€”</span> â€¢ 
      <a href="https://procreditbank.md" target="_blank">procreditbank.md</a> â€¢ 
      <a href="https://bnm.md" target="_blank">bnm.md</a>
    </div>
  </div>

  <script>
    // === Date de backup inline (actualizeazÄƒ-le manual aici) ===
    const backupData = {
      date: "2 decembrie 2025",
      rates: {
        EUR: { buy: "19.6000", sell: "19.8800" },
        USD: { buy: "16.8700", sell: "17.1600" }
      }
    };

    // === 1. ÃŽncercÄƒm live cu proxy nou (mai stabil) ===
    async function fetchLiveRates() {
      try {
        console.log('ÃŽncerc fetch live...'); // Debug
        const proxy = 'https://corsproxy.io/?'; // Proxy gratuit 2025, fÄƒrÄƒ rate limit
        const url = encodeURIComponent('https://www.procreditbank.md/ro');

        const response = await fetch(proxy + url);
        if (!response.ok) throw new Error('RÄƒspuns invalid');
        const html = await response.text();

        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        // Selector actualizat 2025: Tabelul e Ã®n .exchange-rates-table
        const rows = doc.querySelectorAll('.exchange-rates-table tbody tr, table.curs-valutar tr');
        const rates = {};

        rows.forEach((row, index) => {
          console.log(`Row ${index}:`, row.textContent.trim()); // Debug
          const cols = row.querySelectorAll('td');
          if (cols.length >= 3) {
            const valuta = cols[0].textContent.trim().toUpperCase();
            const buy = cols[1].textContent.trim();
            const sell = cols[2].textContent.trim();

            if (valuta.includes('EUR')) {
              rates.EUR = { buy, sell };
              console.log('GÄƒsit EUR:', rates.EUR);
            }
            if (valuta.includes('USD')) {
              rates.USD = { buy, sell };
              console.log('GÄƒsit USD:', rates.USD);
            }
          }
        });

        if (rates.EUR && rates.USD) {
          document.getElementById('status').textContent = 'âœ“ Live';
          console.log('Succes live:', rates);
          return { source: 'live', rates, date: new Date().toLocaleDateString('ro-MD') };
        } else {
          throw new Error('Nu s-au gÄƒsit ratele');
        }
      } catch (e) {
        console.error('Eroare live:', e); // Vezi Ã®n F12 > Console
      }
      return null;
    }

    // === 2. Fallback la backup ===
    function useBackup() {
      console.log('Folosim backup');
      document.getElementById('status').textContent = 'âš¡ Backup (actualizeazÄƒ manual)';
      return { source: 'backup', ...backupData };
    }

    // === 3. AfiÈ™Äƒm tabelul ===
    function displayRates(data) {
      const tbody = document.querySelector('#rates-table tbody');
      document.getElementById('last-update').textContent = data.date;

      // BNM hardcodat (actualizeazÄƒ de pe bnm.md)
      const bnmEUR = '19.68331';
      const bnmUSD = '16.9262';

      tbody.innerHTML = `
        <tr>
          <td><span class="flag">ðŸ‡ªðŸ‡º</span> EUR</td>
          <td class="buy">${data.rates.EUR.buy} MDL</td>
          <td class="sell">${data.rates.EUR.sell} MDL</td>
          <td class="bnm">${bnmEUR} MDL</td>
        </tr>
        <tr>
          <td><span class="flag">ðŸ‡ºðŸ‡¸</span> USD</td>
          <td class="buy">${data.rates.USD.buy} MDL</td>
          <td class="sell">${data.rates.USD.sell} MDL</td>
          <td class="bnm">${bnmUSD} MDL</td>
        </tr>
      `;
    }

    // === Pornim ===
    (async () => {
      let data = await fetchLiveRates();
      if (!data) data = useBackup();
      displayRates(data);
    })();
  </script>
</body>
</html>
